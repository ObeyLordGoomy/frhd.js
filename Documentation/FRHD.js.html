<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="utf-8">
    <title>JSDoc: Source: FRHD.js</title>

    <script src="scripts/prettify/prettify.js"> </script>
    <script src="scripts/prettify/lang-css.js"> </script>
    <!--[if lt IE 9]>
      <script src="//html5shiv.googlecode.com/svn/trunk/html5.js"></script>
    <![endif]-->
    <link type="text/css" rel="stylesheet" href="styles/prettify-tomorrow.css">
    <link type="text/css" rel="stylesheet" href="styles/jsdoc-default.css">
</head>

<body>

<div id="main">

    <h1 class="page-title">Source: FRHD.js</h1>

    



    
    <section>
        <article>
            <pre class="prettyprint source linenums"><code>const https = require('https');

//Vars
let token = null,
    baseURL = 'www.freeriderhd.com';

//Functions
function err(info) {
    console.log(`Error: ${info}`);
    ret(!1, !1, `Error: ${info}`);
}

function ret(tf, d = !1, ms = !1) {
    return { status: tf, data: d, msg: ms }
}

function request(method, path, body, callback) {
    let err,
        options = {
            hostname: baseURL,
            port: 443,
            path: path,
            method: method
        };
    method == 'POST' ? (options.headers = {
        'Content-Type': 'application/x-www-form-urlencoded',
        'carset': 'UTF-8'
    }) : void 0;

    const req = https.request(options, res => {
        let body = '';
        res.setEncoding('utf8');
        res.on('data', data => body += data);
        res.on('end', () => {
            const resp = JSON.parse(body);
            callback(err, resp)
        });
    });

    req.on('error', e => err = e);

    if (method == 'POST')
        req.write(`${body}&amp;ajax=!0&amp;app_signed_request=${token}&amp;t_1=ref&amp;t_2=desk`);

    req.end();
}

function t2t(ticks) {
    let t = ticks / 30 * 1e3;
    t = parseInt(t, 10);
    let e = (t / 6e4) | 0
        , i = (t - 6e4 * e) / 1e3;
    return i = i.toFixed(2),
        10 > e &amp;&amp; (e = e),
        10 > i &amp;&amp; (i = "0" + i),
        e + ":" + i
}

//JSDoc Stuff
/**
 * Callback for all funtions
 * 
 * @callback RequestCallback
 * @param {Object&lt;{status: boolean, data: JSON, msg: string}>} - Json object with status, data, and message (this requires only one param)
 */

//Exports
class FRHD {
    /**
     * Starts the mod
     * @constructor
     */
    constructor() {
        this.token = null,
            this.user = null;
    }

    /**
     * Gets info about a user from name.
     * Does not require login
     * @param {string} uName - Username of user
     * @param {RequestCallback} [cb = () => {}] - Callback
     */
    getUserData(uName, cb = () => { }) {
        if (!uName || typeof uName !== 'string') return err('Invalid arguments');
        req(rData(`u/${uName}?ajax=true`),
            (err, response, data) => {
                if (err) return err(err);
                if (!data.user) return ret(!1, !1, `No user by the name of "${uName}"`);
                cb(ret(!0, data, data.msg ? data.msg : 'Sucuess!'));
            }
        );
    }
    //Account
    /**
     * Verifies Login
     * @param {RequestCallback} [cb = () => {}] - Callback
     */
    loginVerify(cb = () => { }) {
        if (!this.token) return err('You are not logged in');
        req(rData(`?ajax=true`, `frhd_app_sr=${this.token}`),
            (err, response, data) => {
                if (err) return err(err);
                if (!data.user) return ret(!1, !1, `Token is invalid or you are not logged in`);
                this.user = data.user;
                cb(ret(!0, data, data.msg ? data.msg : 'Sucuess!'));
            }
        );
    }
    /**
     * Sets token.
     * Does not require login
     * @param {string} asr - Account token (ask Goodra how to obtain)
     */
    login(asr = '') {
        if (!asr || typeof asr !== 'string') return err('Invalid arguments');
        this.token = asr;
        token = asr;
    }
    /**
     * Logs you out
     */
    logout() {
        if (!this.token) return err('You are not logged in');
        this.token = null,
            this.user = null,
            token = null;
    }
    /**
     * Changes your account name
     * @param {string} name - New name
     * @param {RequestCallback} [cb = () => {}] - Callback
     */
    changeName(name, cb = () => { }) {
        if (!name || typeof name !== 'string') return err('Invalid arguments');
        if (!this.token) return err('You are not logged in');
        request('POST', '/account/edit_profile', `name=u_name&amp;value=${encodeURIComponent(name)}`,
            (err, data) => {
                if (err !== void 0) return err(err);
                this.user = data.user;
                cb(ret(!0, data, data.msg ? data.msg : 'Sucuess!'));
            }
        );
    }
    /**
     * Changes your description
     * @param {string} desc - New description
     * @param {RequestCallback} [cb = () => {}] - Callback
     */
    changeDesc(desc, cb = () => { }) {
        if (!desc || typeof desc !== 'string') return err('Invalid arguments');
        if (!this.token) return err('You are not logged in');
        request('POST', '/account/edit_profile', `name=about&amp;value=${encodeURIComponent(desc).replace('%20', '+')}`,
            (err, data) => {
                if (err !== void 0) return err(err);
                this.user = data.user;
                cb(ret(!0, data, data.msg ? data.msg : 'Sucuess!'));
            }
        );
    }
    /**
     * Sets password
     * @param {string} oldpass - Old password
     * @param {string} newpass - New password
     * @param {RequestCallback} [cb = () => {}] - Callback
     */
    changePassword(oldpass, newpass, cb = () => { }) {
        if (!newpass || typeof newpass !== 'string' || !oldpass || typeof oldpass !== 'string') return err('Invalid arguments');
        if (!this.token) return err('You are not logged in');
        request('POST', '/account/change_password', `old_password=${encodeURIComponent(oldpass).replace('%20', '+')}&amp;new_password=${encodeURIComponent(newpass).replace('%20', '+')}`,
            (err, data) => {
                if (err !== void 0) return err(err);
                this.user = data.user;
                cb(ret(!0, data, data.msg ? data.msg : 'Sucuess!'));
            }
        );
    }
    /**
     * Changes forum password
     * @param {string} pass - Password
     * @param {RequestCallback} [cb = () => {}] - Callback
     */
    forumPass(pass) {
        if (!pass || typeof pass !== 'string') return err('Invalid arguments');
        if (!this.token) return err('You are not logged in');
        request('POST', '/account/update_forum_account', `password=${encodeURIComponent(pass).replace('%20', '+')}`,
            (err, data) => {
                if (err !== void 0) return err(err);
                this.user = data.user;
                cb(ret(!0, data, data.msg ? data.msg : 'Sucuess!'));
            }
        );
    }
    /**
     * Buys a hat
     * @param {RequestCallback} [cb = () => {}] - Callback
     */
    buyHat(cb = () => { }) {
        if (!this.token) return err('You are not logged in');
        request('POST', '/store/buy', '',
            (err, data) => {
                if (err !== void 0) return err(err);
                this.user = data.user;
                cb(ret(!0, data, data.msg ? data.msg : 'Sucuess!'));
            }
        );
    }
    /**
     * Equips a hat
     * @param {number} hatId - ID of hat
     * @param {RequestCallback} [cb = () => {}] - Callback
     */
    equipHat(hatId, cb = () => { }) {
        if (!hatId || typeof hatId !== 'number') return err('Invalid arguments');
        if (!this.token) return err('You are not logged in');
        request('POST', '/store/equip', `item_id=${hatId}`,
            (err, data) => {
                if (err !== void 0) return err(err);
                this.user = data.user;
                cb(ret(!0, data, data.msg ? data.msg : 'Sucuess!'));
            }
        );
    }
    /**
     * Gets data about the track.
     * Does not require login
     * @param {number} tId - ID of track
     * @param {RequestCallback} [cb = () => {}] - Callback
     */
    getTrackData(tId, cb = () => { }) {
        if (!tId || typeof tId !== 'number') return err('Invalid arguments');
        req(rData(`t/${tId}?ajax=true`),
            (err, response, data) => {
                if (err) return err(err);
                this.user = data.user;
                cb(ret(!0, data, data.msg ? data.msg : 'Sucuess!'));
            }
        );
    }
    /**
     * Leaves a comment on a track
     * @param {number} tId - ID of the track
     * @param {string} msg - Message Of comment
     * @param {RequestCallback} [cb = () => {}] - Callback
     */
    comment(tId, msg, cb = () => { }) {
        if (!tId || typeof tId !== 'number' || !msg || typeof msg !== 'string') return err('Invalid arguments');
        if (!this.token) return err('You are not logged in');
        request('POST', '/track_comments/post', `t_id=${tId}&amp;msg=${encodeURIComponent(msg).replace('%20', '+')}`,
            (err, data) => {
                if (err !== void 0) return err(err);
                this.user = data.user;
                cb(ret(!0, data, data.msg ? data.msg : 'Sucuess!'));
            }
        );
    }
}


module.exports = FRHD;
</code></pre>
        </article>
    </section>




</div>

<nav>
    <h2><a href="index.html">Home</a></h2><h3>Classes</h3><ul><li><a href="FRHD.html">FRHD</a></li></ul><h3><a href="global.html">Global</a></h3>
</nav>

<br class="clear">

<footer>
    Documentation generated by <a href="https://github.com/jsdoc/jsdoc">JSDoc 3.6.3</a> on Wed Feb 26 2020 01:56:12 GMT-0500 (Eastern Standard Time)
</footer>

<script> prettyPrint(); </script>
<script src="scripts/linenumber.js"> </script>
</body>
</html>
